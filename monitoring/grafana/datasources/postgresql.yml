apiVersion: 1

# ================================================
# GRAFANA DATASOURCES CONFIGURATION
# Binance Trading System
# ================================================

datasources:
  # ================================================
  # POSTGRESQL WITH TIMESCALEDB
  # ================================================
  - name: PostgreSQL
    type: postgres
    uid: postgres-main
    access: proxy
    url: postgres:5432
    database: binance_trading_dev
    user: postgres
    secureJsonData:
      password: postgres
    jsonData:
      sslmode: disable
      postgresVersion: 1600
      timescaledb: true
      maxOpenConns: 10
      maxIdleConns: 5
      connMaxLifetime: 14400
    editable: true
    isDefault: true

  # ================================================
  # PROMETHEUS
  # ================================================
  - name: Prometheus
    type: prometheus
    uid: prometheus-main
    access: proxy
    url: http://prometheus:9090
    jsonData:
      httpMethod: POST
      timeInterval: 15s
      queryTimeout: 60s
      # Включаем exemplars для трейсинга
      exemplarTraceIdDestinations:
        - name: trace_id
          datasourceUid: tempo
    editable: true
    isDefault: false

  # ================================================
  # POSTGRESQL ANALYTICS SCHEMA
  # ================================================
  - name: PostgreSQL Analytics
    type: postgres
    uid: postgres-analytics
    access: proxy
    url: postgres:5432
    database: binance_trading_dev
    user: postgres
    secureJsonData:
      password: postgres
    jsonData:
      sslmode: disable
      postgresVersion: 1600
      timescaledb: true
      # По умолчанию используем analytics schema
      searchPath: analytics,public
    editable: true
    isDefault: false

  # ================================================
  # REDIS (если установлен redis-datasource plugin)
  # ================================================
  # - name: Redis
  #   type: redis-datasource
  #   uid: redis-main
  #   access: proxy
  #   url: redis://redis:6379
  #   jsonData:
  #     client: standalone
  #     poolSize: 5
  #     timeout: 5000
  #   editable: true
  #   isDefault: false

  # ================================================
  # TEMPO (для distributed tracing, если настроен)
  # ================================================
  # - name: Tempo
  #   type: tempo
  #   uid: tempo
  #   access: proxy
  #   url: http://tempo:3200
  #   jsonData:
  #     httpMethod: GET
  #     tracesToLogs:
  #       datasourceUid: loki
  #       tags: ['job', 'instance', 'pod']
  #   editable: true
  #   isDefault: false

  # ================================================
  # LOKI (для логов, если настроен)
  # ================================================
  # - name: Loki
  #   type: loki
  #   uid: loki
  #   access: proxy
  #   url: http://loki:3100
  #   jsonData:
  #     maxLines: 1000
  #   editable: true
  #   isDefault: false

# ================================================
# NOTES
# ================================================
# 1. Datasources автоматически загружаются при старте Grafana
# 2. Для production используйте секреты вместо plain text паролей
# 3. Включите sslmode для production окружения
# 4. Настройте connection pooling согласно нагрузке
# 5. Используйте uid для стабильных ссылок между dashboards
